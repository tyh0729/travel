<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ—¥æ–‡äº”åéŸ³è‡ªä¸»ç·´ç¿’å·¥å…·</title>
    <style>
        :root { --primary: #4a90e2; --success: #4caf50; --danger: #f44336; --bg: #f8f9fa; }
        body { font-family: 'PingFang TC', sans-serif; background-color: var(--bg); display: flex; flex-direction: column; align-items: center; padding: 20px; }
        #quiz-card { background: white; padding: 2rem; border-radius: 20px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); width: 100%; max-width: 450px; text-align: center; }
        
        .mode-selector { margin-bottom: 20px; display: flex; justify-content: center; gap: 10px; }
        .mode-btn { padding: 8px 16px; border: 2px solid var(--primary); background: white; color: var(--primary); border-radius: 20px; cursor: pointer; font-weight: bold; }
        .mode-btn.active { background: var(--primary); color: white; }

        /* ç­†é †é¡¯ç¤ºå€ */
        #stroke-display {
            margin: 15px auto;
            width: 150px;
            height: 150px;
            background: #fff;
            border: 2px dashed #eee;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 15px;
        }
        #stroke-img { max-width: 90%; max-height: 90%; display: none; }
        .placeholder-text { color: #bbb; font-size: 0.9rem; }

        #play-voice { background: var(--primary); color: white; border: none; width: 60px; height: 60px; border-radius: 50%; font-size: 24px; cursor: pointer; margin-bottom: 15px; }
        
        .options-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; }
        .option { padding: 18px; font-size: 2rem; border: 2px solid #eee; border-radius: 12px; background: white; cursor: pointer; }
        .option.correct { background-color: var(--success) !important; color: white; border-color: var(--success); }
        .option.wrong { background-color: var(--danger) !important; color: white; border-color: var(--danger); }
        
        /* ä¸‹ä¸€é¡ŒæŒ‰éˆ• */
        #next-btn {
            display: none; /* åˆå§‹éš±è— */
            margin-top: 20px;
            width: 100%;
            padding: 15px;
            background-color: #333;
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            transition: background 0.2s;
        }
        #next-btn:hover { background-color: #000; }

        .stat-bar { display: flex; justify-content: space-between; margin-top: 20px; font-size: 0.8rem; color: #888; border-top: 1px solid #eee; padding-top: 15px; }
    </style>
</head>
<body>

<div id="quiz-card">
    <div class="mode-selector">
        <button class="mode-btn active" onclick="setMode('hira', this)">å¹³å‡å</button>
        <button class="mode-btn" onclick="setMode('kata', this)">ç‰‡å‡å</button>
    </div>

    <div id="stroke-display">
        <img id="stroke-img" src="" alt="ç­†é †åœ–">
        <div id="placeholder" class="placeholder-text">ç­”é¡Œå¾Œé¡¯ç¤ºæ­£ç¢ºç­†é †</div>
    </div>

    <button id="play-voice">ğŸ”Š</button>
    
    <div class="options-grid" id="options-container"></div>

    <button id="next-btn" onclick="nextQuestion()">ä¸‹ä¸€é¡Œ â†’</button>

    <div class="stat-bar">
        <span>ç·´ç¿’æ¬¡æ•¸: <strong id="total-count">0</strong></span>
        <span>æ­£ç¢ºç‡: <strong id="accuracy">0%</strong></span>
    </div>
</div>

<script>
    const data = {
        hira: ['ã‚','ã„','ã†','ãˆ','ãŠ','ã‹','ã','ã','ã‘','ã“','ã•','ã—','ã™','ã›','ã','ãŸ','ã¡','ã¤','ã¦','ã¨','ãª','ã«','ã¬','ã­','ã®','ã¯','ã²','ãµ','ã¸','ã»','ã¾','ã¿','ã‚€','ã‚','ã‚‚','ã‚„','ã‚†','ã‚ˆ','ã‚‰','ã‚Š','ã‚‹','ã‚Œ','ã‚','ã‚','ã‚’','ã‚“'],
        kata: ['ã‚¢','ã‚¤','ã‚¦','ã‚¨','ã‚ª','ã‚«','ã‚­','ã‚¯','ã‚±','ç§‘','ã‚µ','ã‚·','ã‚¹','ã‚»','ã‚½','ã‚¿','ãƒ','ãƒ„','ãƒ†','ãƒˆ','ãƒŠ','ãƒ‹','ãƒŒ','ãƒ','ãƒ','ãƒ','ãƒ’','ãƒ•','ãƒ˜','ãƒ›','ãƒ','ãƒŸ','ãƒ ','ãƒ¡','ãƒ¢','ãƒ¤','ãƒ¦','ãƒ¨','ãƒ©','ãƒª','ãƒ«','ãƒ¬','ãƒ­','ãƒ¯','ãƒ²','ãƒ³']
    };

    let currentMode = 'hira';
    let correctAnswer = '';
    let stats = { total: 0, correct: 0 };
    let isAnswering = false;

    function setMode(mode, btn) {
        currentMode = mode;
        document.querySelectorAll('.mode-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        nextQuestion();
    }

    function playSound(text) {
        window.speechSynthesis.cancel();
        const msg = new SpeechSynthesisUtterance(text);
        msg.lang = 'ja-JP';
        msg.rate = 0.8;
        window.speechSynthesis.speak(msg);
    }

    function nextQuestion() {
        isAnswering = false;
        
        // é‡ç½®ä»‹é¢
        document.getElementById('stroke-img').style.display = 'none';
        document.getElementById('placeholder').style.display = 'block';
        document.getElementById('next-btn').style.display = 'none'; // éš±è—ä¸‹ä¸€é¡ŒæŒ‰éˆ•

        const list = data[currentMode];
        correctAnswer = list[Math.floor(Math.random() * list.length)];
        
        let choices = [correctAnswer];
        while(choices.length < 4) {
            let rand = list[Math.floor(Math.random() * list.length)];
            if(!choices.includes(rand)) choices.push(rand);
        }
        choices.sort(() => Math.random() - 0.5);

        const container = document.getElementById('options-container');
        container.innerHTML = '';
        choices.forEach(char => {
            const btn = document.createElement('button');
            btn.className = 'option';
            btn.innerText = char;
            btn.onclick = () => checkAnswer(char, btn);
            container.appendChild(btn);
        });

        playSound(correctAnswer);
    }

    function checkAnswer(selected, btnElement) {
        if(isAnswering) return;
        isAnswering = true;
        stats.total++;

        // é¡¯ç¤ºç­†é †åœ–
        const img = document.getElementById('stroke-img');
        const placeholder = document.getElementById('placeholder');
        const hexCode = correctAnswer.charCodeAt(0).toString(16).padStart(5, '0');
        img.src = `https://raw.githubusercontent.com/KanjiVG/kanjivg/master/kanji/${hexCode}.svg`;
        img.style.display = 'block';
        placeholder.style.display = 'none';

        // é¡¯ç¤ºä¸‹ä¸€é¡ŒæŒ‰éˆ•
        document.getElementById('next-btn').style.display = 'block';

        const allButtons = document.querySelectorAll('.option');
        if(selected === correctAnswer) {
            btnElement.classList.add('correct');
            stats.correct++;
        } else {
            btnElement.classList.add('wrong');
            allButtons.forEach(b => { if(b.innerText === correctAnswer) b.classList.add('correct'); });
        }

        document.getElementById('total-count').innerText = stats.total;
        document.getElementById('accuracy').innerText = Math.round((stats.correct / stats.total) * 100) + '%';
    }

    document.getElementById('play-voice').onclick = () => playSound(correctAnswer);
    nextQuestion();
</script>
</body>
</html>